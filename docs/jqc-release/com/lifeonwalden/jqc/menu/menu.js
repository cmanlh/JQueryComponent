"use strict";!function(M){$JqcLoader.importComponents("com.lifeonwalden.jqc",["baseElement","uniqueKey","lang","dialog","zindex"]).importCss($JqcLoader.getCmpParentURL("com.lifeonwalden.jqc","menu").concat("css/menu.css")).execute(function(){function s(){var t=this;t.mainMenu.off(),t.mainMenu.on("mouseover.jqcMenuItem",".jqcMenuItem",function(n){M(n.target).find(">ul").fadeIn(t.options.speed),n.stopPropagation()}),t.mainMenu.on("mouseleave.jqcMenuItem","li",function(n){M(n.currentTarget).find(">ul").fadeOut(t.options.speed)}),t.mainMenu.on("click.jqcMenuLeaf",".jqcMenuLeaf",function(n){t.mainMenu.find("ul").fadeOut(t.options.speed),t.options.onSelect&&t.options.onSelect(t.menuIndex.get(M(n.target).attr("menuId")))}),t.options.allowedConfig&&(t.settingBtn.off(),t.settingBtn.on("click.jqcMenu",function(n){if(t.isSetting)return t.settingDialog.close(),void n.stopPropagation();t.isSetting=!0,t.settingDialog?t.settingDialog.open():function(){var h=this;h.configurableMenuIndex=new Map,h.settingPanel=M("<div>").addClass("jqcMenuSettingPanel"),h.options.configurableMenuData.forEach(function(n,t,e){h.settingPanel.append(c.call(h,n))}),h.settingPanel.find(">ul").css("width",1.5*h.options.width),h.settingStack=[],h.settingDialog=new M.jqcDialog({title:M.jqcLang.MENU_SETTING_CONFIG,content:h.settingPanel,modal:!1,width:h.options.configBoxWidth,position:{top:h.options.top,left:h.options.width+h.options.left+3},afterClose:function(){h.isSetting=!1}}),h.settingDialog.open(),h.settingPanel.off(),h.settingPanel.on("click.jqcMenu",".jqcMenuConfigLeaf",function(n){"INPUT"!=n.target.tagName?(h.settingDialog.close(),h.options.onSelect&&h.options.onSelect(h.configurableMenuIndex.get(M(n.target).parent().attr("menuConfigId")))):n.stopPropagation()}),h.settingPanel.on("change.jqcMenu","input",function(n){var t,e=M(n.target),i=e.parent().parent(),a=i.attr("menuConfigId"),o=(i.attr("parentId"),h.configurableMenuIndex.get(a),i.parents("li:first")),s=o.parents("li:first");if(n.target.checked)t=!0,o.find("input").eq(0).prop("checked",t),s.find("input").eq(0).prop("checked",t),i.find("input").prop("checked",t);else{t=!1,i.find("input").prop("checked",t);for(var p=o.find("input"),r=!1,c=1;c<p.length;c++){var d=p[c];r=!!d.checked||r}p.eq(0).prop("checked",r);for(var l=s.find("input"),u=!1,f=1;f<l.length;f++){var d=l[f];u=!!d.checked||u}l.eq(0).prop("checked",u)}g.call(h,!0)})}.call(t)}))}function p(n){var a=this,o=M("<ul>").addClass("jqcMenuBox");return n.forEach(function(n,t,e){var i=n[a.options.adapter.id];a.snapshot?a.snapshot[i]&&o.append(r.call(a,n)):o.append(r.call(a,n))}),o}function r(n){var t=this,e=M("<li>"),i=this.options.autoSkip?function n(t){var e=this;var i=this;var a=[];var o=i.options.adapter.child;if(!t.hasOwnProperty(o)||!Array.isArray(t[o])||0===t[o].length)return t;a=this.snapshot?t[o].filter(function(n){return e.snapshot[n[i.options.adapter.id]]}):t[o];var s=a.length;if(2<=s)return t;if(1===s)return n.call(i,a[0])}.call(t,n):n;e.text(i[t.options.adapter.label]),t.hasMenuId||(i[t.options.adapter.id]="jqc".concat(M.jqcUniqueKey.fetchIntradayKey()));var a=i[t.options.adapter.id];e.attr("menuId",a);var o=t.options.adapter.child;return i.hasOwnProperty(o)&&Array.isArray(i[o])&&0<i[o].length?1===i[o].length&&t.options.autoSkip?(e.text(i[o][0][t.options.adapter.label]),e.attr("menuId",i[o][0][t.options.adapter.id]),e.addClass("jqcMenuLeaf"),t.menuIndex.set(i[o][0][t.options.adapter.id],i[o][0])):(e.addClass("jqcMenuItem"),e.append(p.call(t,i[o]))):e.addClass("jqcMenuLeaf"),t.menuIndex.set(a,i),e}function g(n){var t=this;this.menuIndex=new Map;this.options.configurableMenuData;var e=this.settingPanel.find("input");this.snapshot={};for(var i=0;i<e.length;i++){var a=e[i],o=M(a).attr("data-id");M(a).prop("checked")&&(t.snapshot[o]=!0)}this.mainMenu.remove(),this.mainMenu=p.call(t,t.options.configurableMenuData),this.container.append(t.mainMenu),s.call(this),this.options.onResettingMenu&&n&&(clearTimeout(this.reRenderCallBackHandler),this.reRenderCallBackHandler=setTimeout(function(){var e=[];t.mainMenu.find("li").each(function(n,t){e.push(M(t).attr("menuId"))}),t.options.onResettingMenu(e)},3e3))}function c(n,i){var a=this,o=M("<ul>").addClass("jqcMenuConfigItem");return Array.isArray(n)?n.forEach(function(n,t,e){o.append(d.call(a,n,i))}):o.append(d.call(a,n,i)),o}function d(n,t){var e=this,i=M("<li>"),a=n[e.options.adapter.id];this.menuIndex.has(a)&&setTimeout(function(){for(var n=i.parent().parent();n.attr("menuconfigid");)n.find("input").eq(0).prop("checked",!0),n=n.parent().parent();g.call(e)},200),i.append(M("<div>").text(n[e.options.adapter.label]).append('<input type="checkbox" data-id='+a+"".concat(e.menuIndex.has(a)?' checked="checked"':"").concat(">").concat("<span></span>"))),i.attr("menuConfigId",a);var o=e.options.adapter.child;return n.hasOwnProperty(o)&&Array.isArray(n[o])&&0<n[o].length?(1===n[o].length&&i.addClass("jqcMenuOnly"),i.addClass("jqcMenuConfigItem"),i.append(c.call(e,n[o],a))):i.addClass("jqcMenuConfigLeaf"),t&&i.attr("parentId",t),e.configurableMenuIndex.set(a,n),i}M.jqcMenu=function(n){if(0<arguments.length&&M.jqcBaseElement.apply(this,arguments),this.options=M.extend(!0,{},{data:null,speed:200,width:150,position:"fixed",top:0,left:0,adapter:{id:"id",label:"label",child:"child"},configBoxWidth:500,displayed:!0,allowedConfig:!1,autoSkip:!0,configurableMenuData:null,onResettingMenu:null,onSelect:null},n),this.typeName="jqcMenu",this.elementId="jqc".concat(M.jqcUniqueKey.fetchIntradayKey()),this.options.allowedConfig){if(!this.options.configurableMenuData[0].hasOwnProperty(this.options.adapter.id))throw new Error("Configuration menu require [id] property in the menu object.");this.snapshot=null}(function(){var n=this;n.container=M("<div>").addClass("jqcMenu").css("position",n.options.position).css("width",n.options.width).css("left",n.options.left).css("top",n.options.top),0==n.options.displayed&&n.hide();n.container.css("z-index",M.jqcZindex.menu),n.options.allowedConfig&&(n.setting=M("<div>").addClass("jqcMenuSetting"),n.settingBtn=M("<span>").attr("title",M.jqcLang.MENU_SETTING),n.setting.append(n.settingBtn),n.container.append(n.setting));this.options.allowedConfig?n.hasMenuId=n.options.configurableMenuData[0].hasOwnProperty(n.options.adapter.id):n.hasMenuId=n.options.data[0].hasOwnProperty(n.options.adapter.id);this.menuIndex=new Map,n.mainMenu=p.call(n,n.options.data),n.container.append(n.mainMenu),M("body").append(n.container)}).call(this),s.call(this)},M.jqcMenu.prototype=new M.jqcBaseElement,M.jqcMenu.prototype.constructor=M.jqcMenu,M.jqcMenu.prototype.show=function(){"fixed"==this.options.position?this.container.animate({left:this.options.left},this.options.speed):this.container.fadeIn()},M.jqcMenu.prototype.hide=function(){"fixed"==this.options.position?this.container.animate({left:-1*this.options.width-this.options.left-3},this.options.speed):this.container.fadeOut()}})}(jQuery);
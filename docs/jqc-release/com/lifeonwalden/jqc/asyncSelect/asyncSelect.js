"use strict";function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(o){$JqcLoader.importComponents("com.lifeonwalden.jqc",["baseElement","uniqueKey","valHooks"]).importCss($JqcLoader.getCmpParentURL("com.lifeonwalden.jqc","asyncSelect").concat("css/asyncSelect.css")).execute(function(){var c=37,a=38,s=39,r=40,l=13;o.jqcAsyncSelect=function(t){var e=this;if(!t.el)throw new Error("jqcAsyncSelect: 缺少el参数");if(!(t.el instanceof jQuery))throw new Error("jqcAsyncSelect: el非jQuery对象");if("INPUT"!=t.el[0].nodeName)throw new Error("jqcAsyncSelect: el非input标签");if(!t.url)throw new Error("jqcAsyncSelect: 缺少url参数");this.defaultValue=t.defaultValue||"",this.input=t.el,this.url=t.url,this.wait=t.wait||500,this.placeholder=t.placeholder||"输入选项值",this.max=t.max||10,this.triggerLen=t.triggerLen||0,this.requestData=t.requestData||function(t){return{data:t}},this.getResult=t.getResult||function(t){return t.result||t.data||[]},this.adapter=t.adapter||{value:"value",text:"text"},this.format=t.format||function(t){return t[e.adapter.text]},this.timer=null,t.el.data("jqcAsyncSelect",this),this.init()},o.jqcAsyncSelect.prototype.init=function(){this.input.addClass("jqcAsyncSelect-input").prop("readOnly",!0),this.elWidth=this.input.outerWidth(),this.elHeight=this.input.outerHeight(),this.input.css("background-position",this.elWidth-25),this.bindEvent(),null!=this.defaultValue&&""!=this.defaultValue&&(this.input.data("value",this.defaultValue),this.getAsyncData(!0))},o.jqcAsyncSelect.prototype.bindEvent=function(){var e=this;this.input.off("click"),this.input.click(function(t){t.stopPropagation(),o(this).hasClass("active")||(o(".jqcAsyncSelect-input").removeClass("active"),e.render())}),o(document).off("click.jqcAsyncSelect"),o(document).on("click.jqcAsyncSelect",function(t){o(".jqcAsyncSelect-container").remove();var e=o(".jqcAsyncSelect-input");o.each(e,function(t,e){var i=o(e).data("jqcAsyncSelect");i&&i.close()})})},o.jqcAsyncSelect.prototype.close=function(){this.input.removeClass("active"),this.container&&(this.container.remove(),this.container=null),o(document).off("keyup.upAndDown")},o.jqcAsyncSelect.prototype.render=function(){var e=this,t=this.input.offset();this.input.addClass("active");var i=o(".jqcAsyncSelect-container");i.length&&i.remove(),this.searchInput=o("<input>").addClass("jqcAsyncSelect-search").prop("placeholder",this.placeholder).css("width",this.elWidth),this.resetBtn=o("<button>").addClass("jqcAsyncSelect-reset").text("重置");var n=o("<div>").addClass("jqcAsyncSelect-searchBar");n.append(this.searchInput,this.resetBtn),this.ul=o("<ul>").addClass("jqcAsyncSelect-result-box").hide(),this.container=o("<div>").addClass("jqcAsyncSelect-container").css("width",this.elWidth+54).append(n,this.ul).css({top:t.top+this.elHeight+4,left:t.left}),o("body").append(this.container),this.searchInput.trigger("focus"),this.container.click(function(t){t.stopPropagation()}),this.searchInput.keyup(function(t){t.keyCode!=a&&t.keyCode!=r&&t.keyCode!=c&&t.keyCode!=s&&t.keyCode!=l&&e.search()}),this.resetBtn.click(function(){e.reset()})},o.jqcAsyncSelect.prototype.getAsyncData=function(c){var s=this,a=null;this.ajax&&this.ajax.abort(),""==(a=c?this.input.data("value"):this.searchInput.val().trim())||a.length<this.triggerLen?c?(s.input[0].value="",s.input.trigger("change",{})):this.renderResult([]):this.ajax=o.ajax({url:this.url,method:"GET",data:this.requestData(a),success:function(t){var e=s.getResult(t);if(c){var i,n=e.filter(function(t){return t[s.adapter.value]==a});if(1==n.length)s.input[0].value=s.format(n[0]),s.input.trigger("change",n[0]);else s.input.data("value",a),s.input[0].value=a,s.input.trigger("change",(_defineProperty(i={},s.adapter.value,a),_defineProperty(i,s.adapter.text,a),i)),console.error("jqcAsyncSelect: 未查询到"+a)}else s.renderResult(e)}})},o.jqcAsyncSelect.prototype.search=function(){var t=this;this.timer&&clearTimeout(t.timer),this.timer=setTimeout(function(){t.getAsyncData()},t.wait)},o.jqcAsyncSelect.prototype.renderResult=function(t){var n=this,i=t.splice(0,this.max);this.ul.empty();var c=-1;if(i&&i.length){var s=this.adapter.value;this.adapter.text;if(null==i[0][s])throw new Error("jqcAsyncSelect: adapter适配错误");i.forEach(function(e,t){var i=o("<li>").addClass("jqcAsyncSelect-item").text(n.format(e));i.data("data",e),i.click(function(t){t.stopPropagation(),n.input.data("value",e[s]),n.input[0].value=n.format(e),n.close(),n.input.trigger("change",e)}),n.ul.append(i)}),this.ul.show(),o(document).off("keyup.upAndDown"),o(document).on("keyup.upAndDown",function(t){var e=n.ul.find("li");if(e.removeClass("active"),t.keyCode==a)c=--c<0?i.length-1:c;else{if(t.keyCode!=r)return t.keyCode==l?void(-1!=c&&e.eq(c).trigger("click")):void 0;c=++c>=i.length?0:c}e.eq(c).addClass("active")})}else{var e=o("<li>").addClass("jqcAsyncSelect-item-none").text("无对应选项");this.ul.append(e).show()}},o.jqcAsyncSelect.prototype.reset=function(){this.input.data("value",this.defaultValue),this.getAsyncData(!0),this.close()}})}(jQuery);
"use strict";!function(v){$JqcLoader.importComponents("com.lifeonwalden.jqc",["baseElement","uniqueKey","valHooks"]).importCss($JqcLoader.getCmpParentURL("com.lifeonwalden.jqc","select").concat("css/select.css")).execute(function(){var d=38,h=40,p=13,f={"*":{value:"",label:"全部"},null:{value:"",label:"空"}};v.jqcSelect=function(e){if(!(e.el&&e.el instanceof jQuery))throw new Error("jqcSelect: 缺少el参数或el参数非jQuery对象");this._el=e.el,this._el.data("jqcSelect")instanceof v.jqcSelect&&this._el.data("jqcSelect").destroy(),(this._defaultValue=null)!=e.defaultValue&&(this._defaultValue=e.defaultValue.toString()),null!=this._el.attr("defaultvalue")&&(this._defaultValue=this._el.attr("defaultvalue")),null!=e.onSelect&&"function"==typeof e.onSelect&&(this.onSelect=e.onSelect),this._adapter=Object.assign({},{value:"value",label:"label"},e.adapter||{}),this.cellRender=e.cellRender||null,this.currentIndex=-1,this.listLen=0,this._data=e.data||[],this._observer(),this.currentValue=this._defaultValue,this.init(),this.bindEvent()},v.jqcSelect.prototype._observer=function(){var l=this;Object.defineProperty(this,"currentValue",{set:function(t){if(l._el.data("value",t),""===t&&null!=l._el.attr("ext"))return l._el[0].value=f[l._el.attr("ext")].label,l._el.trigger("change",f[l._el.attr("ext")]),void(l.onSelect&&l.onSelect(f[l._el.attr("ext")]));var e=l._data.filter(function(e){return e[l._adapter.value].toString()==t});1==e.length?(l._el[0].value=l.format(e[0]),l._el.trigger("change",e[0]),l.onSelect&&l.onSelect(e[0])):l._el[0].value=t},get:function(){return l._el.data("value")}})},v.jqcSelect.prototype.init=function(){this._el.data("jqcSelect",this),this._el.addClass("jqcSelect-input").prop("readOnly",!0).css("background-position",this._el.outerWidth()-25)},v.jqcSelect.prototype.bindEvent=function(){var t=this;this._el.on("click.jqcSelect",function(e){e.stopPropagation(),v(this).hasClass("active")?t.close():(v(".jqcSelect-input").removeClass("active"),t.render())}),this._el.blur(function(){t.lock||t.close()})},v.jqcSelect.prototype.render=function(){var c=this,e=this._adapter.label,t=this._adapter.value;this._el.addClass("active");var l=this._el.outerWidth(),n=this._el.outerHeight(),a=this._el.offset();this.scrollTop=v(document).scrollTop();var i=v(".jqcSelect-container");i.length&&i.remove(),this.ul=v("<ul>").addClass("jqcSelect-items");var o=this._el.attr("ext");if(null!=o){e=f[o].label,t=f[o].value;var r=v("<li>").text(e).attr("value",t);this.ul.append(r),r.data({value:t,data:f[o]}),t===c.currentValue&&(c.currentIndex=0,r.addClass("active"))}this._data.forEach(function(e,t){var l=e[c._adapter.value].toString(),n=c.format(e),a=v("<li>").attr("value",l);c.cellRender&&(n=c.cellRender(n,e)),a.append(n).attr("title",n),l==c.currentValue&&a.addClass("active"),c.ul.append(a),a.data({value:l,data:e})});var s=a.top+n+4-c.scrollTop,u=window.innerHeight;s+30*this._data.length+10>u&&(s=s-30*this._data.length-8-n),this.container=v("<div>").addClass("jqcSelect-container").css("width",l).append(this.ul).css({top:s,left:a.left}),v("body").append(this.container),this.container.on("click","li",function(e){e.stopPropagation(),c.currentValue=v(this).data("value"),c.close()}),this.container.mouseenter(function(){c.lock=!0}).mouseleave(function(){c.lock=!1}),v(document).on("keyup.jqcSelect-upAndDown",function(e){switch(e.stopPropagation(),e.keyCode){case d:c.currentIndex=c.currentIndex<=0?c.listLen-1:--c.currentIndex,c.container.find("li").removeClass("active").eq(c.currentIndex).addClass("active");break;case h:c.currentIndex=c.currentIndex>=c.listLen-1?0:++c.currentIndex,c.container.find("li").removeClass("active").eq(c.currentIndex).addClass("active");break;case p:c.container.find("li").eq(c.currentIndex).trigger("click")}}),this.listLen=this.container.find("li").length,this.currentIndex=this.container.find("li.active").index(),v(document).on("click.jqcSelect",function(e){c.close()}),v(window).on("scroll.jqcSelect",function(e){c.scrollTop=v(document).scrollTop(),c.container.css({top:a.top+n+4-c.scrollTop})})},v.jqcSelect.prototype.close=function(){this.lock=!1,this._el.removeClass("active"),this.container&&(this.container.remove(),this.container=null),v(document).off("keyup.jqcSelect-upAndDown"),v(document).off("click.jqcSelect"),v(window).off("scroll.jqcSelect")},v.jqcSelect.prototype.format=function(e){return"function"==typeof this._adapter.label?this._adapter.label(e):e[this._adapter.label]},v.jqcSelect.prototype.destroy=function(){this.close(),this._el.data({value:void 0,jqcSelect:void 0}).removeClass("jqcSelect-input").off("click.jqcSelect").prop("readonly",!1).val("")}})}(jQuery);
"use strict";!function(m){$JqcLoader.importComponents("com.lifeonwalden.jqc",["datetimepicker","dateUtil","inputNumber","tip","lang","uniqueKey","notification"]).execute(function(){function l(t,a,e){this.target=t,this.prop=a,this.type=e}function c(t){var a={},e={};for(var r in t){var n=t[r],i=n.getTarget(),c=n.getType(),o=n.getProp(),l=!0,u=m.trim(i.val());if(""!==u){switch(c){case"int":u=window.parseInt(u),m.isNumeric(u)||v(i,m.jqcLang.FORM_UTIL_INVALID_VALUE);var p=m.trim(i.attr("min"));m.isNumeric(p)&&window.parseInt(p)>u&&v(i,m.jqcLang.FORM_UTIL_INVALID_MIN.concat(p));var s=m.trim(i.attr("max"));m.isNumeric(s)&&window.parseInt(s)<u&&v(i,m.jqcLang.FORM_UTIL_INVALID_MAX.concat(s));break;case"number":u=window.parseFloat(u),m.isNumeric(u)||v(i,m.jqcLang.FORM_UTIL_INVALID_VALUE);p=m.trim(i.attr("min"));m.isNumeric(p)&&window.parseFloat(p)>u&&v(i,m.jqcLang.FORM_UTIL_INVALID_MIN.concat(p));s=m.trim(i.attr("max"));m.isNumeric(s)&&window.parseFloat(s)<u&&v(i,m.jqcLang.FORM_UTIL_INVALID_MAX.concat(s));break;case"date":try{u=m.jqcDateUtil.toMilliSeconds(u,!0)}catch(t){v(i,m.jqcLang.FORM_UTIL_INVALID_DATE)}break;case"string":case"text":u=u||"";break;case"radio":i.is(":checked")&&(e[o]=u),l=!1;break;case"checkbox":i.is(":checked")&&(e[o]=e[o]||[]).push(u),l=!1;break;default:var d=m.trim(i.attr("maxlength"));m.isNumeric(d)&&u.length>d&&v(i,m.jqcLang.FORM_UTIL_INVALID_MAX_LENGTH.concat(d))}l&&Object.assign(a,f(o,u))}else l&&Object.assign(a,f(o,u))}for(var g in e)Object.assign(a,f(g,e[g]));return a}function a(t){var a=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],e=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];a&&n(t,!1,function(t,a,e){s(t,e)}),e&&r(t,!1,function(t,a,e){s(t,e)})}function r(t){var c=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],o=2<arguments.length?arguments[2]:void 0,n=new Map;return t.find("[groupbind]").each(function(t,a){var e=m(a),r=m.trim(e.attr("groupbind")),i=[];e.find("[gdatabind]").each(function(t,a){var e=m(a),r=m.trim(e.attr("gdatabind")),n=(m.trim(e.attr("datatype"))||m.trim(e.attr("type"))||"string").toLowerCase();r&&(o&&"function"==m.type(o)&&o(e,r,n),c&&i.push(new l(e,r,n)))}),c&&(n.has(r)||n.set(r,[]),n.get(r).push({target:e,beans:i}))}),n}function n(t){var i=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],c=2<arguments.length?arguments[2]:void 0,o=[];return t.find("[databind]").each(function(t,a){var e=m(a),r=m.trim(e.attr("databind")),n=(m.trim(e.attr("datatype"))||m.trim(e.attr("type"))||"string").toLowerCase();c&&"function"==m.type(c)&&c(e,r,n),i&&o.push(new l(e,r,n))}),o}function f(t,a){for(var e={},r=t.split("."),n=r.length-1;0<=n;n--){var i=m.trim(r[n]);0<i.length&&(e[i]=a,a=e,e={})}return a}function p(t){for(var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=t.split("."),r=e.length,n=null,i=0;i<r;i++)a=n=a[e[i]];return n}function s(r,t){if(!r.data("_formatted")){switch(t||(t=(m.trim(r.attr("datatype"))||m.trim(r.attr("type"))||"string").toLowerCase()),t){case"int":new m.jqcInputNumber({element:r});break;case"number":var a=m.trim(r.attr("dataScale"));a.length<=0&&(a=2),new m.jqcInputNumber({element:r,decimals:a});break;case"textnumber":var e=null!=r.attr("limit-prefix");r.on({keyup:function(){e?r.val((r.val()||"").replace(/\D/g,"").replace(/^(0+)/g,"")):r.val((r.val()||"").replace(/\D/g,""))},paste:function(t){var a=t.originalEvent;window.clipboardData&&window.clipboardData.getData?window.clipboardData.getData("Text"):a.clipboardData&&a.clipboardData.getData&&a.clipboardData.getData("text/plain"),e?r.val((r.val()||"").replace(/\D/g,"").replace(/^(0+)/g,"")):r.val((r.val()||"").replace(/\D/g,"")),t.stopPropagation()}});break;case"date":r.datetimepicker(),r.attr("placeholder","yyyy-mm-dd");break;case"alpha":var n=/\`|[^(a-zA-Z\d\.\_\-)]/g;r.on({keyup:function(t){var a=r.val(),e=r[0].selectionStart;n.test(a)&&(e-=1),r.val(a.replace(n,"")),r[0].selectionStart=e,r[0].selectionEnd=e},paste:function(t){var a="",e=t.originalEvent;return console.log(t.originalEvent),e.clipboardData&&e.clipboardData.getData&&(a=e.clipboardData.getData("text/plain")),r.val((a||"").replace(n,"")),t.stopPropagation(),!1}})}r.data("_formatted",!0)}}function d(t,a,e,r){var n=p(a,r);switch(e){case"date":if(n){var i=t.attr("format")||"yyyy-MM-dd";t.val(m.jqcDateUtil.format(n,i))}break;case"checkbox":n&&"array"==m.type(n)&&((t.get(0)||{}).checked=-1!=n.indexOf(m.trim(t.val())));break;case"radio":m.trim(t.val())==n&&((t.get(0)||{}).checked=!0);break;default:t.val(n)}}function e(t){if(!(t&&t instanceof m))throw new Error("".concat(t," should be jQuery object"))}function v(t,a){if(0<t.parents(".outerErrorTip").length){var e=t.siblings(),r="";1<=e.length&&(r=e.eq(0).text()),m.jqcNotification({type:"error",title:r+a})}else t.tip(a);throw new Error(a)}m.formUtil={},m.formUtil.format=function(t){e(t),a(t)},m.formUtil.fill=function(t){var u=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};e(t),a(t,!0,!1);n(t,!1,function(t,a,e){a||v(t,m.jqcLang.FORM_UTIL_INVALID_DATABIND),d(t,a,e,u)}),r(t,!0).forEach(function(t,a,e){var r=[];for(var n in t){var i=t[n];r.push(i.target)}var c=new Map;r[0].find("input[type=radio]").each(function(t,a){c.set(m(a).attr("name"),!0)});for(var o=p(a,u)||[];o.length>r.length;){var l=r[0].clone();0<c.size&&c.forEach(function(t,a,e){l.find("input[type=radio][name=".concat(a).concat("]")).attr("name","jqc".concat(m.jqcUniqueKey.fetchIntradayKey()))}),r[r.length-1].after(l),r.push(l)}for(var n in r)r[n].find("[gdatabind]").each(function(t,a){var e=m(a),r=(m.trim(e.attr("datatype"))||m.trim(e.attr("type"))||"string").toLowerCase();s(e),d(e,m.trim(e.attr("gdatabind")),r,o[n])})})},m.formUtil.fetch=function(t){e(t);var i={},a=n(t,!0,function(t,a,e){0==a.length&&v(t,m.jqcLang.FORM_UTIL_INVALID_DATABIND),t.attr("required")&&!m.trim(t.val())&&v(t,m.jqcLang.FORM_UTIL_INVALID_REQUIRED),t.attr("required")&&t.attr("strict")&&!m.trim(t[0].value)&&v(t,m.jqcLang.FORM_UTIL_INVALID_REQUIRED)});return i=c(a),r(t,!0,function(t){t.attr("required")&&!m.trim(t.val())&&v(t,m.jqcLang.FORM_UTIL_INVALID_REQUIRED)}).forEach(function(t,a,e){for(var r in t){var n=t[r];(i[a]=i[a]||[]).push(c(n.beans))}}),i},l.prototype.getProp=function(){return this.prop},l.prototype.getTarget=function(){return this.target},l.prototype.getType=function(){return this.type}})}(jQuery);
"use strict";!function(u){$JqcLoader.importComponents("com.lifeonwalden.jqc",["baseElement","uniqueKey","toolkit"]).importCss($JqcLoader.getCmpParentURL("com.lifeonwalden.jqc","contextmenu").concat("css/contextmenu.css")).execute(function(){var c=u.jqcToolkit,i=u("body"),e={menus:[],max:null,onSelect:null,adapter:{id:"id",text:"text",child:"child",valid:"valid"},autoSkip:!0,width:160,height:32};function p(t){var o,e="__temp";if(!t.hasOwnProperty(e)||!Array.isArray(t[e])||0===t[e].length)return t;var i=(o=t[e]).length;return 2<=i?t:1===i?p.call(this,o[0]):void 0}u.jqcContextMenu=function(t){this.options=Object.assign({},e,t),this.box=null,this.level=1,this.needShowMenus=[],this.pageWidth=window.innerWidth,this.pageHeight=window.innerHeight,this.width=this.options.width,this.height=this.options.height,this.scrollTop=u(window).scrollTop(),this.data=null,this.toLeft=!1,this.toTop=!1,this.maxHeight=this.options.max?this.options.max*this.height:"auto";var o=this.options.menus.length;this.firstLevlHeight=this.options.max&&o>this.options.max?this.maxHeight:o*this.height,function(){var o=this;u(window).resize(function(){o.pageWidth=window.innerWidth,o.pageHeight=window.innerHeight}).scroll(function(){o.scrollTop=u(this).scrollTop()}),u(document).on("contextmenu click",function(t){o.pageX=t.pageX,o.pageY=t.pageY}).on("mouseup",function(){u(this).off("mousemove.comtextmenu-slide")}).click(function(t){o.options.onCancel&&o.options.onCancel(),o.box&&o.box.remove()})}.call(this)},u.jqcContextMenu.prototype.show=function(t){i.find(".jqcContextMenu").remove();var o=this;this.level=1,this.data=Array.prototype.slice.call(arguments);var e=[].concat(o.options.menus);this.needShowMenus=function i(t,n){var s=this;var a=this;var o=[];var h=[].concat(n);var l=null;l=1<h.length?h.shift():h[0];o=t.filter(function(t){var o=t[a.options.adapter.valid],e=t[a.options.adapter.child];if("Undefined"===c.rawType(o))return e&&(t.__temp=i.call(a,e,h)),!0;if("Function"===c.rawType(o))return!(void 0!==l&&!o.apply(s,n))&&(e&&(t.__temp=i.call(a,e,h)),!0);if("Boolean"===c.rawType(o))return!!o&&(e&&(t.__temp=i.call(a,e,h)),!0);throw new Error("jqcContextMenu: valid expects a Boolean or Function")});o.showData=l;return o}.call(o,e,o.data),this.options.autoSkip&&(this.needShowMenus=function t(o){return Array.isArray(o)&&1===o.length&&o[0].__temp?t.call(this,o[0].__temp):o}.call(o,this.needShowMenus)),this.level=function(){var o=[],e=1;return this.needShowMenus.forEach(function(t){t.__temp&&(e=2,o=o.concat(t.child))}),o.forEach(function(t){t.__temp&&(e=3)}),e}.call(o),setTimeout(function(){(function(){i.append(function(){var t=this,o=0;this.box=u("<div>").addClass("jqcContextMenu").css({left:t.pageX,top:t.pageY}).click(function(t){t.stopPropagation()}).on("contextmenu",function(t){t.stopPropagation(),t.preventDefault()}),o=this.pageX+this.level*this.width>this.pageWidth?(this.box.addClass("to-left"),this.toLeft=!0,-this.width):(this.box.removeClass("to-left"),this.toLeft=!1,0);this.pageY+this.firstLevlHeight-this.scrollTop>this.pageHeight?(this.box.addClass("to-top"),this.toTop=!0):(this.box.removeClass("to-top"),this.toTop=!1);return this.box.append(function a(h,t,o){var l=this,e=u("<div>").addClass("jqcContextMenu-scrollBox").css({"max-height":l.maxHeight,width:l.width+20});h.forEach(function(s){l.options.autoSkip&&(s=p.call(l,s));var t=u("<div>").addClass("jqcContextMenu-item").text(s[l.options.adapter.text]).on("mouseenter",function(t){t.stopPropagation(),u(this).siblings().removeClass("jqcContextMenu-active");var o=u(this).parents(".jqcContextMenu-fakeScrollBox"),e=o.index();if(l.box.find(".jqcContextMenu-fakeScrollBox:gt("+e+")").remove(),Array.isArray(s.__temp)&&0<s.__temp.length){u(this).addClass("jqcContextMenu-active");var i=u(this).offset().top;e++;var n=l.toLeft?-(l.width*(e+1)-e):l.width*e-e;l.box.append(a.call(l,s.__temp,i,n))}}).click(function(t){t.stopPropagation(),Array.isArray(s.__temp)&&0!==s.__temp.length||(l.options.onSelect&&l.options.onSelect({menu:s,showData:h.showData}),l.box.remove())}).css({height:l.height,width:l.width-2,"line-height":l.height+"px"});e.append(t)});var i=u("<div>").addClass("jqcContextMenu-fakeScrollBox").append(e).css({"max-height":l.maxHeight,width:l.width-2,left:o});if(this.options.max&&h.length>l.options.max){var c=parseInt(l.options.max*l.maxHeight/h.length),r=u("<span><span>").addClass("jqcContextMenu-slide").on("mousedown click",function(t){t.stopPropagation();var i=u(this).siblings(".jqcContextMenu-scrollBox"),o=u(this).parent().offset().top+1,n=t.pageY,s=u(this).offset().top-o;u(document).on("mousemove.comtextmenu-slide",function(t){var o=t.pageY-n+s;o=(o=o<0?0:o)+c>l.maxHeight?l.maxHeight-c:o,r.css("top",o);var e=(o+c)*h.length*l.height/l.maxHeight-l.maxHeight;i.scrollTop(e)})});r.height(c),i.append(r),e.scroll(function(t){t.stopPropagation();var o=u(this).scrollTop(),e=(l.maxHeight+o)*l.maxHeight/l.height/h.length-c;r.css("top",e)})}if(t){var n=h.length*l.height;l.options.max&&(n=h.length>l.options.max?l.options.max*l.height:n),t-l.scrollTop+n+20>this.pageHeight?i.css({top:"auto",bottom:l.box.offset().top-t-l.height-1+l.scrollTop}):i.css({top:t-l.box.offset().top-1-l.scrollTop,bottom:"auto"})}return i}.call(t,t.needShowMenus,0,o)),this.box}.call(this))}).call(o)},0)},u.jqcContextMenu.prototype.hide=function(){i.find(".jqcContextMenu").remove()}})}(jQuery);
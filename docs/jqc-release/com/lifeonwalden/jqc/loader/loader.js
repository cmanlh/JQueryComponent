"use strict";!function(t){function n(t){return null==t||"string"!=typeof t||0==t.length}var e=/\./g;function o(t,e){if(this.name=t,this.baseURL=e,this.componentMap=new Map,n(this.name))throw new Error("Module name is required.");if(n(this.baseURL))throw new Error("Module base url is required.");return this}function r(t){if(this.name=t.name,this.version=t.version,this.module=t.module,this.loaded=!1,n(this.name))throw new Error("Component name is required.");if(-1!=this.name.indexOf(".js"))throw new Error("Component name must exclude file suffix name [.js].");if(null===this.module||null==this.module)throw new Error("Module for component is required.");return this}o.prototype.getName=function(){return this.name},o.prototype.getURL=function(){var t=this.name.replace(e,"/").concat("/");return this.baseURL.lastIndexOf("/")==this.baseURL.length-1?this.baseURL.concat(t):this.baseURL.concat("/").concat(t)},o.prototype.registerComponent=function(t,e){var n=new r({name:t,version:e,module:this});return this.componentMap.set(n.getName(),n),this},o.prototype.registerComponents=function(t,o){var r=this;return Array.isArray(t)&&t.forEach(function(t,e,n){r.registerComponent(t,o)}),this},o.prototype.getComponent=function(t){return this.componentMap.get(t)},r.prototype.getName=function(){return this.name},r.prototype.getURL=function(){return n(this.version)?this.module.getURL().concat(this.name).concat("/"):this.module.getURL().concat(this.name).concat("/").concat(this.version).concat("/")},r.prototype.toLoaded=function(){this.loaded=!0},r.prototype.getLoaded=function(){return this.loaded};var s=1,a=2,c=4;function i(){this.version="",this.moduleMap=new Map,this.cmpStack=[],this.jsStack=[],this.cssStack=[],this.resources={greenPath:[],normal:[]},this.loadingCount=0,this.loadedUrl=new Map}function u(t,e,n){e&&t.unshift({fun:e,type:3,param:n});for(var o=this.jsStack.shift();o;o=this.jsStack.shift())t.unshift(o);for(var r=this.cssStack.shift();r;r=this.cssStack.shift())t.unshift(r);for(var i=this.cmpStack.shift();i;i=this.cmpStack.shift())t.unshift(i);0<this.loadingCount||(this.loadingCount+=1,function t(){var e=this;var n=null;n=0<e.resources.greenPath.length?e.resources.greenPath.shift():e.resources.normal.shift();if(n){if(e.loadedUrl.has(n.url))return void t.call(e);if(s==n.type||c==n.type){var o=document.createElement("script");o.src=n.url+e.version,o.type="text/javascript";var r=function(){o.removeEventListener("load",r),c==n.type&&n.cmp.toLoaded(),e.loadedUrl.set(n.url,!0),t.call(e)};o.addEventListener("load",r),o.addEventListener("error",function(){console.error("资源加载出错："+n.url),t.call(e)}),document.getElementsByTagName("head")[0].appendChild(o)}else if(a==n.type){var i=document.createElement("link");i.href=n.url+e.version,i.rel="stylesheet",i.type="text/css";var r=function(){i.removeEventListener("load",r),e.loadedUrl.set(n.url,!0),t.call(e)};i.addEventListener("load",r),i.addEventListener("error",function(){console.error("资源加载出错："+n.url),t.call(e)}),document.getElementsByTagName("head")[0].appendChild(i)}else n.fun(n.param),t.call(e);this.loadingCount+=1}this.loadingCount-=1}.call(this))}i.prototype.registerModule=function(t){return this.moduleMap.set(t.getName(),t),this},i.prototype.setVersion=function(t){return this.version=t?"?version="+t:"",this},i.prototype.importScript=function(t){return this.jsStack.unshift({url:t,type:s}),this},i.prototype.importCss=function(t){return this.cssStack.unshift({url:t,type:a}),this},i.prototype.importComponents=function(t,e){var n=this.moduleMap.get(t);if(!n)throw new Error("Module [".concat(t).concat("]").concat("is not registered"));for(var o in e){var r=e[o],i=n.getComponent(r);if(!i)throw new Error("Component [".concat(r).concat("]").concat("is not registered"));i.getLoaded()||this.cmpStack.unshift({url:i.getURL().concat(r).concat(".js"),type:c,cmp:i})}return this},i.prototype.getCmpParentURL=function(t,e){var n=this.moduleMap.get(t);if(!n)throw new Error("Module [".concat(t).concat("]").concat("is not registered"));var o=n.getComponent(e);if(!o)throw new Error("Component [".concat(e).concat("]").concat("is not registered"));return o.getURL()},i.prototype.execute=function(t,e){var n=this.resources.normal;u.call(this,n,t,e)},i.prototype.executeNow=function(t,e){var n=this.resources.greenPath;u.call(this,n,t,e)};var h=new i;h.newModule=function(t,e){return new o(t,e)},t.$JqcLoader=h}(window);